---
- name: Create new LXC container in Proxmox Cygnus Host
  become: yes
  gather_facts: No
  hosts: "{{ HOSTS }}"
  vars:
    ansible_python_interpreter: /usr/bin/python3

  tasks:
    # - name: "Check if container exist"
    #   proxmox:
    #     api_host: "pimentel-homelab"
    #     api_user: "root@pam"
    #     api_password: "5045160"
    #     # ---
    #     vmid: "203"
    #     state: absent

    # - name: "Create Container"
    #   proxmox:
    #     vmid: "301" # Specifying Container ID
    #     api_user: "root@pam" # Proxmox user
    #     api_password: "5045160" # Password in plaintext !!!
    #     api_host: "pimentel-homelab" # Proxmox hostname
    #     password: "12345" # Password in plaintext !!!
    #     hostname: "ct-tst3-ansible" # Container hostname
    #     node: "pimentel-homelab" # Name of Proxmox host
    #     cores: "1"
    #     cpus: "2"
    #     cpuunits: "1000"
    #     ostemplate: "local:vztmpl/debian-11-turnkey-core_17.1-1_amd64.tar.gz" # Or use local:vztmpl/... as discussed
    #     storage: "local-lvm" # Or use 'local' as discussed
    #     disk: "8"
    #     memory: "512"
    #     # nameserver: '10.100.0.1'
    #     netif: '{"net0":"name=eth0,ip=dhcp,ip6=dhcp,bridge=vmbr0,tag=50"}'
    #     # searchdomain: 'prod.lab'
    #     state: "present"

    - name: Get list available templates on node
      uri:
        url: "http://pimentel-homelab:8006/api2/json/nodes/pimentel-homelab/storage/local/content"
        method: GET
        headers:
          Cookie: "PVEAuthCookie={{ pve_node_ticket.json.data.ticket }}"
        body_format: form-urlencoded
        return_content: yes
        validate_certs: "{{ pve_disable_cert_check | default('no') }}"
      register: pve_ct_template_list
