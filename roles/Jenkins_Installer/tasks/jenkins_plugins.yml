---
- name: Wait for Jenkins to start up
  uri:
    url: http://192.168.99.21:8080/login?from=%2F
    status_code: 200
    timeout: 5
  register: jenkins_service_status
  # Keep trying for 5 mins in 5 sec intervals
  retries: 60
  delay: 5
  until: >
     'status' in jenkins_service_status and
     jenkins_service_status['status'] == 200

- name: Install Plugins
  jenkins_plugin:
    name: "{{ item }}"
    # state: latest
    url_username: admin
    url_password: "{{ adminPasswordResult.stdout }}"
  with_items: 
    - ace-editor
    - ant
    - antisamy-markup-formatter
    - apache-httpcomponents-client-4-api
    - bootstrap4-api
    - bootstrap5-api
    - bouncycastle-api
    - branch-api
    - build-timeout
    - caffeine-api
    - checks-api
    - cloudbees-folder
    - command-launcher
    - credentials
    - credentials-binding
    - display-url-api
    - durable-task
    - echarts-api
    - email-ext
    - font-awesome-api
    - git
    - git-client
    - git-server
    - github
    - github-api
    - github-branch-source
    - gradle
    - handlebars
    - jackson2-api
    - jaxb
    - jdk-tool
    - jjwt-api
    - jquery3-api
    - jsch
    - junit
    - ldap
    - lockable-resources
    - mailer
    - matrix-auth
    - matrix-project
    - momentjs
    - okhttp-api
    - pam-auth
    - pipeline-build-step
    - pipeline-github-lib
    - pipeline-graph-analysis
    - pipeline-input-step
    - pipeline-milestone-step
    - pipeline-model-api
    - pipeline-model-definition
    - pipeline-model-extensions
    - pipeline-rest-api
    - pipeline-stage-step
    - pipeline-stage-tags-metadata
    - pipeline-stage-view
    - plain-credentials
    - plugin-util-api
    - popper-api
    - popper2-api
    - resource-disposer
    - scm-api
    - script-security
    - snakeyaml-api
    - ssh-credentials
    - ssh-slaves
    - sshd
    - structs
    - timestamper
    - token-macro
    - trilead-api
    - workflow-aggregator
    - workflow-api
    - workflow-basic-steps
    - workflow-cps
    - workflow-cps-global-lib
    - workflow-durable-task-step
    - workflow-job
    - workflow-multibranch
    - workflow-scm-step
    - workflow-step-api
    - workflow-support
    - ws-cleanup
    - script-security
    - command-launcher
    - blueocean

- name: Restart Jenkins Service
  service:
    name: jenkins
    state: restarted

- name: Sleep for 30 seconds and continue with play ...
  wait_for: timeout=30
  delegate_to: localhost