---
- name: Debug system facts
  debug:
    var: ansible_facts
  apply:
    delegate_to: "{{ _hostname }}"

# - name: Gather facts
#   ansible.builtin.setup:
#   become: true  # Certifique-se de usar sudo se necess√°rio

- name: Add EPEL repository
  become: true
  # become_method: sudo
  become_user: "{{ _vm_default_user }}"
  # # vars:
  # #   ansible_become_password: "toor"
  package:
    name: epel-release
    state: latest

- name: Update the system packages
  package:
    name: "*"
    state: latest

# - name: Upgrade the system
#   package:
#     upgrade: yes

# - name: Clean the local repository
#   package:
#     autoclean: yes

- name: Remove packages not needed anymore
  package:
    autoremove: yes

- name: Install common packages
  package:
    name: "{{ item }}"
    state: latest
  ignore_errors: true
  with_items: 
    - "{{ install_os_packages }}"
  register: installPackageResult

- name: Print Install common packages
  debug:
    var: installPackageResult

- name: set system timezone
  register: modify_timezone
  timezone:
      name: America/Recife

- name: Get Time Zone
  register: timezone
  ignore_errors: true
  command: timedatectl

- name: Show Time Zone
  debug:
    var: timezone.stdout
  notify: Reboot System

- name: Wait for "{{ _hostname }}" to become reachable
  wait_for:
    host: "{{ _hostname }}"
    port: 22
    delay: 10
    timeout: 120

- name: Start qemu-guest-agent Service
  service:
    name: qemu-guest-agent
    state: started
    enabled: yes
  ignore_errors: true
  notify: Reboot System